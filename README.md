# MoreWindows

MoreWindows，一个oink的组件，提供了网页overlay层上的几乎一切功能：悬浮窗、菜单、弹出框、提示框、消息框……

## 兼容性

仅兼容较新的现代浏览器。目前通过测试的各浏览器如下：

|         PC         |     Android      |        MAC        |        iOS        |
| :----------------: | :--------------: | :---------------: | :---------------: |
|   Google Chrome    | Via（即webview） | 无Mac设备可供测试 | 无iOS设备可供测试 |
|      Firefox       |     小米自带     |                   |                   |
| Edge（Chrome内核） |     华为自带     |                   |                   |
|       Opera        |                  |                   |                   |
|        360         |                  |                   |                   |
|         QQ         |                  |                   |                   |
|        傲游        |                  |                   |                   |
|        搜狗        |                  |                   |                   |

IE9以下无`box-shadow`，使用`border`进行了兼容。可自行更改。（IE兼容性未系统测试，反正肯定不容乐观）

## 使用

引入文件并创建实例：

```html
<link rel="stylesheet" href="mwds.css" />
...
<script src="mwds.js"></script>
<script>
    var mwds = new MWDS;
</script>
```

mwds在创建实例时会自动进行一些初始化操作。下文均使用`mwds`作为实例。

## 特别注意

1. mwds没有考虑具有全局横向滚动条的页面（因为确实太罕见了），如果要在具有或可能具有横向滚动条的页面上使用，请遵循以下避坑做法（不排除还会有其他坑）：

   - 不搭配使用`ds-a`和`ds-mov`

   - 自定义通知框的动画，不要使用默认动画

2. mwds组件设计时**并没有**考虑到组件的属性变化，因此对于所有已经释放至文档中的组件，它们在mwds中的事件和属性**不可更改**。对于用惯了Vue、React等框架的开发者来说，这点是致命伤。

   - 例子：**不可以**通过移除class将一个带有`ds-mov`class的可移动窗口变得不可移动。
     - 如果确有此需求，请删除该元素并重新向mwds声明该元素。
   - 为什么不考虑实时监测组件？
     1. 我不想让注册组件的过程变成一个复杂又无聊的过程。原本mwds在运行时都不能注册新组件，组件必须在HTML中已经声明。现在改成了运行时注册，我已经觉得很复杂了。
     2. 实时监测组件的开销实在是太大了，也许vdom是个解决方案，不过这只是一个小组件，没必要。
     3. 目前我所有用到mwds的项目都只需要很少的运行时属性更改或甚至不需要，因此这个功能确实没用。
   - 还是一句话，组件库是用来方便自己的。

3. 为了方便进行一些常见的操作，构建了一个JS库：[`luery`](https://github.com/ljm12914/luery)，它支持基本的DOM选择和DOM操作，后文中的`$("...")`即为它所提供。

## 一、窗口

### 新建（TODO）

```javascript
mwds.win($("#mywin"));
```

`$("#mywin")`：窗口元素。

或者直接添加class：

```javascript
$("#mywin").addClass("ds-win");
```

### class表

|    class    |            描述             | 互斥 |      缺省      |
| :---------: | :-------------------------: | :--: | :------------: |
|  `ds-win`   |        定义一个窗口         |      |  **自动生成**  |
|   `ds-a`    |   窗口位置行为`absolute`    |      |    `fixed`     |
|  `ds-tra`   | 窗口背景透明，hover后变白色 |      | 永远为指定颜色 |
|  `ds-mov`   |         窗口可移动          |      |    不可移动    |
|  `ds-cls`   |   双击窗口的空闲部分关闭    |      |   无关闭功能   |
| `ds-ontop`  |    置于最顶层（见下方）     |      |  动态窗口提升  |
| `ds-resize` |         可调整大小          |      |    自动大小    |

对`.ds-win`的样式表进行编辑即可自定义其样式，不过请注意`/*<某属性>不可更改*/`的注释，更改这些属性可能导致难以预料的问题出现。

置顶窗口`ds-ontop`的`z-index`为`999`（主要是我不相信有人可以搞出950个窗口），并通过`animation:ontop`保持。置顶窗口的边框颜色有所改变，以突出其为置顶。可自定义样式。

`ds-ontop`已知问题：当两个大小完全相同的`ds-ontop`窗口完全重叠在一起时，无法移动其中任何一个。

### 窗口提升相关（WILLFIX）

任何窗口式图形化界面都拥有这个功能：点击一个处于下方的窗口中的内容，这个窗口就会提升到上方。

窗口的`z-index`最小值（默认值）是`50`，目前不支持修改。头铁可以去改改试试。若出现堆叠窗口，z-index的范围会向**上**扩展以容纳这些窗口。移动中的窗口拥有**目前页面中所有窗口的`z-index`最大值+1**的`z-index`，以确保它的拖动不会受任何窗口影响（但是可能会受到其他元素影响，建议使用置顶元素时`z-index`不要太小，以免拖动窗口出现问题）。

## 二、提示框

提示框（Tooltip）是hover一些元素时弹出的小框，用于提示该元素的作用。提示框类是`.ds-tt`。提示框的`z-index`为其产生区域的`z-index`，所以可能看不到提示框。

### 新建（TODO）

```javascript
mwds.appendToolTip($("#target-Element"), "tooltip html", "direction", <showTip>);
```

`$("#target-Element")`：要放置提示框的元素。

`"tooltip html"`：在提示框中展现的HTML。

| direction |       描述       |
| :-------: | :--------------: |
|     t     | 在上方显示提示框 |
|     b     | 在下方显示提示框 |
|     l     | 在左方显示提示框 |
|     r     | 在右方显示提示框 |

`<showTip>`：是否显示提示框的尖端三角形。

该方法无返回值，运行后将在`$("#target-Element")`的末尾添加一个提示框元素，此时整个HTML看上去像这样：

```html
<any id="target-Element" class="ds-tp">
    content
    <div class="ds-tt ds-tt-t-t">tooltip html</div>
</any>
```

对`.ds-tt`的样式表进行编辑即可自定义其样式，不过请注意`/*<某属性>不可更改*/`的注释，更改这些属性可能导致难以预料的问题出现。

### 智能显示（DOING）

如果mwds发现提示框被浏览器的边界截断，就会将提示框移至其他地方以使其完全显示（通常是对面）。

### 极端情况

不能在同一个元素中包含多个提示框。

## 三、弹出框

从屏幕中间弹出一个窗口。mwds会在加载时自动创建覆盖层（`#ds-overlay`），所有窗口都是这个覆盖层的子元素。支持多个窗口，但是没有自动调整窗口相对高度的功能（因为可能导致一些语义问题），需要保证**后显示的窗口不会把已有窗口挡住。**窗口居中，比较难以修改（因为使用了flex布局）。

弹出框显示时会有动画，并且`#ds-overlay`将页面的其余部分调暗。用户点击页面上不属于弹出框的位置即可删除最上一个弹出框。

`#ds-overlay`无弹出框时的`z-index`为-1，有弹出框时的`z-index`为`999`。

由于在面积小时很容易被关闭，弹出框**不适合**用于将一些信息展现给用户，而适合包含较多元素、占据较大屏幕面积的交互型界面，例如设置界面。可使用下文的通知框展现信息。

### 新建

```javascript
var n = mwds.showPopUp($("#element"));
```

`$("#element")`：作为弹出框弹出的元素。该元素会被**复制**到遮罩层。

该方法会返回该弹出框在`$("#ds-overlay").children`中的下标序号，可用于删除该弹出框。

### class表

弹出框拥有默认的样式，可自定义样式。无其他特殊属性。

### 关闭

将需要删除的弹出框的**下标序号**传给`hidePopUp()`方法。该方法返回被删除的弹出框元素。

```javascript
el == mwds.hidePopUp(n); //el===$("#element")
```

#### 关闭所有

无参数调用`hidePopUp()`方法。此时返回所有弹出框元素。

```javascript
mwds.hidePopUp();
```

## 四、菜单

浏览器的右键菜单以无用著称（除了最下面那个“检查”）。

注：菜单组件不兼容移动端；由于历史遗留问题，菜单（menu）与下拉框（dropdown）在mwds中**为同一组件**，均表示在用户右键点击某个页面元素后在光标处弹出的元素。

### 新建

直接使用HTML文件中的元素：

```javascript
var el = $("#element");
```

其实也可以在运行时新建一个元素，但是可能会出现未知的问题。推荐使用已有元素。

### class表

mwds的菜单除了在光标右下角，还可以**默认**在光标其他三个角弹出，以增加一次展现的量。但是，一次在一个角只允许弹出一个菜单，传入多个在同一角弹出的菜单时，仅第一个会弹出。

菜单弹出时会有一个类似于弹出框的动画。

建议：尽量不要同时在四个角显示菜单，这样子比较难关掉。

|       属性class       |                        描述                        |             缺省             |
| :-------------------: | :------------------------------------------------: | :--------------------------: |
|        `ds-dd`        |                    定义一个菜单                    |         **自动生成**         |
| `ds-dd-<br/bl/tr/tl>` |                   菜单的弹出位置                   |     右下角（`ds-dd-br`）     |
|      `ds-nocls`       | 菜单在用户点击其中元素后不关闭，必须点击页面才关闭 | 菜单在用户点击其中元素后关闭 |

对`.ds-dd`的样式表进行编辑即可自定义其样式，不过请注意`/*<某属性>不可更改*/`的注释，更改这些属性可能导致难以预料的问题出现。

默认样式的`z-index`为`9999`。需要搭配的HTML如下：

```html
<div class="ds-dd">
    <ul>
        <li>first menu item</li>
        <li>second</li>
        ...
    </ul>
</div>
```

### 显示菜单

通过`registerDropDown()`给特定DOM元素注册一个菜单，可以控制在右键点击特定元素时才显示菜单。

菜单允许在点击目标元素的子元素时通过事件冒泡弹出，这**是刻意的设计**。若不需要在点击目标元素的子元素时也弹出菜单，则可在注册菜单时添加第三个参数`true`阻止事件冒泡导致菜单弹出。

mwds**不会**阻止在菜单上右键点击的事件。但是**不要给菜单中的某个元素再绑定菜单**，头铁可以去试试。

```javascript
mwds.registerDropDown($("#element"),el);
mwds.registerDropDown($("#element-inner"),el2);
mwds.registerDropDown($("#no-propagation-inner"),el2);
mwds.registerDropDown($("#no-propagation"),el3,true); //禁用事件冒泡
```

假设`*-inner`是`*`的子元素，那么在上述示例代码中，仅有`el2`会在`#no-propagation-inner`被右键点击时弹出，而`el`和`el2`在`#element-inner`被右键点击时都会弹出。

注：千万不要在生产环境中给所有元素绑定菜单`registerDropDown($("*"),...)`，头铁可以去试试。

### 关闭菜单

在需要的时候调用`closeDropDown()`关闭所有菜单。

mwds已内置的关闭逻辑：点击页面中的非菜单元素时会关闭所有菜单，点击非`.ds-nocls`菜单任意子元素后也会关闭所有菜单。其余逻辑需要自定义。

mwds仅提供关闭所有菜单的方法调用，这**是刻意的设计**。若不想一次关闭所有菜单，请自定义逻辑。

### 多级菜单

可以在菜单中安排扩展框元素。扩展框见下。

### 智能显示（DOING）

mwds认为菜单项目均为竖排，横排菜单不受支持，请尽量不要使用。

如果mwds发现菜单的**横**轴被浏览器的边界截断，就会将菜单移至光标的其他角以使其完全显示。

如果mwds发现菜单的**纵**轴被浏览器的边界截断，就会将菜单移至光标的其他角以使其完全显示；如果这样做也不行，那么会将菜单缩短，使其带滚轮地完全显示。

## 五、扩展框（TODO）

点击或hover一个元素后，这个元素临时展开一个扩展框。点击或hover页面的其余部分时，该扩展框自动收回。

### 新建



没错，和`.ds-tt`很像。

```html
<div necessary>
    <div class="ds-exp"><strong>content</strong> <button>and interaction</button></div>
    <div>main content</div>
</div>
```

### 属性表

就连属性表也很像`.ds-tt`……

|      属性class       |                         描述                         |   缺省    |
| :------------------: | :--------------------------------------------------: | :-------: |
|       `ds-exp`       |                    定义一个扩展框                    |   必需    |
|       `ds-ep`        |               **自动生成的**父元素标记               |   必有    |
|  `ds-exp-<t/b/l/r>`  | 控制扩展框的显示位置，`t`=上，`b`=下，`l`=左，`r`=右 | 二选一(1) |
| `ds-exp-<t/b/l/r>-t` |                 显示三角形“气泡”效果                 | 二选一(1) |

对`.ds-exp`的样式表进行编辑即可自定义其样式，不过请注意`/*<某属性>不可更改*/`的注释，更改这些属性可能导致难以预料的问题出现。

### 智能显示

如果mwds发现拓展框被浏览器的边界截断，就会将拓展框移至其他地方以使其完全显示。与`.ds-tt`不同的是，它会先尝试平移至可以完全展现的区域，如果没有合适的区域，再转移至对面。

### 自定义显示

有时候不希望将拓展框居中对齐将其展开的元素。此时可以直接编写嵌入样式或内联样式来操控具体位置。拓展框父元素的`position`为`relative`。

下面的示例代码将`#exp`拓展框定位至其父元素之下2rem。

```css
#exp{
    top: 2rem;
    left: 0;
}
```

### 极端情况

不兼容在同一个元素中包含多个带有`.ds-exp`的元素的状况，此时只有在文档流中最靠前的元素可以被识别，并且会出现一些问题。

## 六、固定栏（TODO）

`ds-win`并不需要总是滑动。有时候需要将一个窗口固定在某个位置，或更重要的，将一个窗口重新放入正常文档流中。`ds-fixpos`。

### 新建

`document.createElement("div").classList.add("ds-fixpos")`。

要将其绑定到指定的窗口，编辑元素的Attribute：`data-ds-fixpos="<id1> <id2> ..."`。

示例：

```html
<div class="ds-win" id="id-1"></div>
<div class="ds-win" id="id-2"></div>
<div class="ds-win" id="id-3"></div>
<div class="ds-win" id="id-4"></div>
<div class="ds-win" id="id-5"></div>
...
<div class="ds-fixpos" data-ds-fixpos="id-1 id-2 id-3“></div>
```

对`ds-fixpos`的样式表进行编辑即可自定义其样式，不过请注意`/*<某属性>不可更改*/`的注释，更改这些属性可能导致难以预料的问题出现。

### 行为

当鼠标指针进入`ds-fixpos`区域时，它会显示并引导松开鼠标，若在`ds-fixpos`区域内松开鼠标，则窗口将固定至`ds-fixpos`区域内，成为`ds-fixpos`的子元素。当固定在`ds-fixpos`中的窗口被重新拖出来，它会**默认被放置到`body`的文档流起始点**（相当于`document.body.prepend`）。

### 属性表

|  属性class  |      描述      | 互斥 | 缺省 |
| :---------: | :------------: | :--: | :--: |
| `ds-fixpos` | 定义一个固定栏 |      | 必需 |

### 极端情况

## 七、通知框（TODO）

mwds的通知框有4种默认**样式**：警告通知、提醒通知、成功通知和普通通知。除此之外，样式完全可自定义；

有4种默认**形式**：带确认取消按钮的通知框、带一个输入框的通知框、带输入确认的通知框（Github上*删库*时弹出的“Type ... to confirm”那种）、仅文本的通知框。除此之外，形式完全可自定义；

按动画分为3种：角落弹出、上方弹出和全屏弹出。用户对浏览器边缘出现的元素敏感性要低于角落出现的元素，**特别是从下边缘弹出的元素**，因为正常的文档流即为从下往上，用户已习惯新元素从下方出现了。（其实动画也可自定义）

### 新建

#### 默认形式

带确认取消按钮的通知框为提醒通知**样式**；带输入确认的通知框为警告通知样式；带一个输入框的通知框和仅文本的通知框为普通通知样式。

允许直接创建4种默认**形式**的通知框。

创建一个仅文本的通知框，默认为普通通知：

```javascript
mwds.noti("text");
```

使用其他默认样式（下同）：

```javascript
mwds.noti("text","info"); //普通通知
mwds.noti("text","success"); //成功通知
mwds.noti("text","warning"); //提醒通知
mwds.noti("text","danger"); //警告通知
```

创建一个带确认取消按钮的通知框：

```javascript
var result = mwds.confirmNoti("text"); //返回true或false
```

创建一个带一个输入框的通知框：

```javascript
var result = mwds.promptNoti("text"); //返回输入的字符串，若无，返回""
```

创建一个带输入确认的通知框：第三个参数为需要输入确认的文本

```javascript
var result = mwds.typeConfirmNoti("text",undefined,"text-to-type");
```

#### 自定义形式

使用已有的HTML元素即可。

```javascript
mwds.noti($("#element"),"info"); //普通通知
mwds.noti($("#element"),"success"); //成功通知
mwds.noti($("#element"),"warning"); //提醒通知
mwds.noti($("#element"),"danger"); //警告通知
```

或使用自定义样式（其实就是自定义class名称，`info` `success`什么的全是class名称。注意有`ds`前缀！！）：

```javascript
noti(el,"customized-class"); //自定义样式
```

```css
.ds-customized-class{
    /*在这里书写样式*/
    /*注意需要在class名称前加上ds-！！！*/
}
```

通知框没有保留样式，可以完全自定义。但是完全自定义会损伤一些功能，如自动关闭倒计时条。一个默认的通知框是这样的，可以仿照以获取完整功能：

```html
<div class="ds-noti ds-info">
    <div class="ds-noti-progress"></div>
    <div class="ds-noti-main">
        ::before <!--用于显示默认样式的图标-->
        content
    </div>
    <div class="ds-noti-op">
        <button class="ds-noti-ok">确定</button>
        <button class="ds-noti-cancel">取消</button>
        ...
    </div>
</div>
```

