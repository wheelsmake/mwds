# Oink组件：MWDS

MoreWindows，一个oink的组件，提供了网页overlay层上的几乎一切功能：悬浮窗、菜单、弹出框、提示框、消息框……

~~这是我用JQuery写的第一个组件~~ 现在已经不用了，Vanilla JS NB！窗口操作使用html原生。为了方便进行一些常见的操作，构建了一个JS库：`luery`，它支持基本的DOM选择和DOM操作。后文中的`$("...")`即为它所提供。注意：它**不支持**多级css选择器，如`$("body div")`会返回`null`。

## 兼容性

**应该**兼容各浏览器的较新版本**吧**。目前通过测试的各浏览器如下：

|         PC         |        MAC        |     Android      |        iOS        |
| :----------------: | :---------------: | :--------------: | :---------------: |
|   Google Chrome    | 无Mac设备可供测试 | Via（即webview） | 无iOS设备可供测试 |
|      Firefox       |                   |     小米自带     |                   |
| Edge（Chrome内核） |                   |     华为自带     |                   |
|       Opera        |                   |                  |                   |
|        360         |                   |                  |                   |
|         QQ         |                   |                  |                   |
|        傲游        |                   |                  |                   |
|        搜狗        |                   |                  |                   |

IE9以下无`box-shadow`，使用`border`进行了兼容。可自行更改。（事实上IE`ds-mov`根本动不了，笑死）

## 一、窗口

### 新建

`document.createElement("div").classList.add("ds-win")`。

### 属性表（DOING）

| 属性class  |                  描述                  | 互斥 |      缺省      |
| :--------: | :------------------------------------: | :--: | :------------: |
|  `ds-win`  |              定义一个窗口              |      |      必需      |
|   `ds-a`   |         窗口位置行为`absolute`         |      |    `fixed`     |
|  `ds-tra`  |      窗口背景透明，hover后变白色       |      | 永远为指定颜色 |
|  `ds-mov`  |               窗口可移动               |      |    不可移动    |
|  `ds-cls`  |         双击窗口的空闲部分关闭         |      |   无关闭功能   |
| `ds-ontop` |        置于所有**窗口**的最顶层        |      |                |
|  `ds-zin`  | 窗口提升程序使用的标志，不要手动设置！ |      |                |

对`.ds-win`的样式表进行编辑即可自定义其样式，不过请注意`/*<某属性>不可更改*/`的注释，更改这些属性可能导致难以预料的问题出现。

### 窗口提升相关（DOING）

任何窗口式图形化界面都拥有这个功能：点击一个处于下方的窗口，它就会提升到上方。mwds也不例外。

窗口的`z-index`最小值（默认值）是`50`，目前不支持修改。若出现堆叠窗口，z-index的范围会向上扩展以容纳这些窗口。移动中的窗口拥有**目前页面中所有窗口的`z-index`最大值+1**的`z-index`，以确保它的拖动不会受任何窗口影响（但是可能会受到其他元素影响！建议使用置顶元素时`z-index`不要太小，以免拖动窗口出现问题）。

## 二、提示框

提示框（Tooltip）是hover一些元素时弹出的小框，用于提示该元素的作用。提示框类是`.ds-tt`。提示框的`z-index`为`999`。

### 新建

标准用法：

```html
<div|span necessary>
    <div|span class="ds-tt">tip content</div|span>
    <div|span>main content</div|span>
</div|span>
```

`necessary`是必须的，它规定了能产生提示框的区域。如果在块级元素中，则应使用`<div>`。如果在行内元素中，则应使用`<span>`，但是**不推荐在行内元素中使用提示框**。

**提示**：`.ds-tt`最好位于`main content`前，否则可能出现对齐问题。

### 属性表

|      属性class      |                         描述                         |   缺省    |
| :-----------------: | :--------------------------------------------------: | :-------: |
|       `ds-tt`       |                    定义一个提示框                    |   必需    |
|       `ds-tp`       |               **自动生成的**父元素标记               |   必有    |
|  `ds-tt-<t|b|l|r>`  | 控制提示框的显示位置，`t`=上，`b`=下，`l`=左，`r`=右 | 二选一(1) |
| `ds-tt-<t|b|l|r>-t` |                 显示三角形“气泡”效果                 | 二选一(1) |

对`.ds-tt`的样式表进行编辑即可自定义其样式，不过请注意`/*<某属性>不可更改*/`的注释，更改这些属性可能导致难以预料的问题出现。

### 智能显示（DOING）

如果Javascript发现提示框被浏览器的边界截断，就会将提示框移至其他地方以使其完全显示（通常是对面）。

### 极端情况

不兼容在同一个元素中包含多个带有`.ds-tt`的元素的状况，此时只有在文档流中最靠前的元素可以被识别。

## 三、弹出框

从屏幕中间弹出一个窗口。mwds会在加载时自动创建覆盖层（`#ds-overlay`），所有窗口都是这个覆盖层的子元素。支持多个窗口，但是没有自动调整窗口相对高度的功能（因为可能导致一些语义问题），需要保证**后显示的窗口不会把已有窗口挡住。**窗口居中，比较难以修改（因为使用了flex布局）。

弹出框显示时会有动画，并且`#ds-overlay`将页面的其余部分调暗。用户点击页面上不属于弹出框的位置即可删除最上一个弹出框。

`#ds-overlay`无弹出框时的`z-index`为-1，有弹出框时的`z-index`为`9999999`。

### 属性表

弹出框的默认样式与窗口`.ds-win`一样。可自定义样式。无其他特殊属性。

### 新建

新建一个DOM对象，用于弹出框。

```javascript
var el = document.createElement("div");
el.innerHTML = "test1<br />test2";
```

或直接使用HTML文件中的元素：

```javascript
var el = $("#element");
```

### 显示弹出框

将DOM对象传给`showPopUp()`方法即可。该方法会返回该弹出框在`$("#ds-overlay").children`中的下标序号，可用于删除该弹出框。

```javascript
var n = showPopUp(el);
```

### 删除弹出框

将需要删除的弹出框的下标序号传给`hidePopUp()`方法。该方法返回被删除的弹出框DOM对象。

```javascript
el == hidePopUp(n) //true
```

#### 删除所有弹出框

无参数调用`hidePopUp()`方法。

```javascript
hidePopUp();
```

## 四、菜单（DOING)

浏览器的右键菜单以无用著称（除了最下面那个“检查”）。

### 新建

新建一个DOM对象，用于菜单。

```javascript
var el = document.createElement("div");
```

或直接使用HTML文件中的元素（拥有`.ds-dd`或`ds-dd-<br|bl|tr|tl>`的元素默认`display`均为`none`，其余请自定义）：

```javascript
var el = $("#element");
```

### 属性表

mwds的菜单除了在光标右下角，还可以**默认**在光标其他三个角弹出，以增加一次展现的量。但是，一次在一个角只允许弹出一个菜单，传入多个在同一角弹出的菜单时，仅第一个会弹出。

菜单弹出时会有一个类似于弹出框的动画。

建议：尽量不要同时在四个角显示菜单，这样子比较难关掉。

|       属性class       |      描述      |    缺省    |
| :-------------------: | :------------: | :--------: |
| `ds-dd-<br|bl|tr|tl>` | 菜单的弹出位置 | `ds-dd-br` |
|        `ds-dd`        | 菜单的推荐样式 |  其他样式  |

可完全自定义其样式，不过建议使用推荐样式`.ds-dd`，若有需要，手动添加。

### 显示菜单

通过给需要的DOM对象绑定事件，可以控制在右键点击特定元素时才显示菜单。

下面代码中存在的事件冒泡导致`el`和`el2`一同在`#element`被右键点击时显示，这**是刻意的设计**。若`#element`不需要`el2`菜单，则可加上`e.stopPropagation()`或使用其他策略阻止事件冒泡。

为了兼容，mwds不阻止默认事件，所以请务必在需要阻止默认事件时添加`e.preventDefault()`。

```javascript
$("#element").oncontextmenu = e=>{ //看不懂箭头用法请去学习ES6语法规范
    e.preventDefault();
    showDropDown(el);
};
window.oncontextmenu = e=>{ //全局菜单
    e.preventDefault();
    showDropDown(el2);
}
```

### 隐藏菜单

用户点击页面其他内容时自动隐藏。

### 多级菜单

可以在菜单中安排能产生扩展框的元素。扩展框见下。

## 五、扩展框（TODO）

点击一个元素后，这个元素临时展开一个扩展框。点击页面的其余部分时，该扩展框自动收回。

### 新建

没错，和`.ds-tt`很像。唯一的区别是扩展框只能是块级元素，故不可使用`<span>`。

```html
<div necessary>
    <div class="ds-exp">tip content</div>
    <div>main content</div>
</div>
```

### 属性表

就连属性表也很像`.ds-tt`……

|      属性class       |                         描述                         |   缺省    |
| :------------------: | :--------------------------------------------------: | :-------: |
|       `ds-exp`       |                    定义一个扩展框                    |   必需    |
|       `ds-ep`        |               **自动生成的**父元素标记               |   必有    |
|  `ds-exp-<t|b|l|r>`  | 控制扩展框的显示位置，`t`=上，`b`=下，`l`=左，`r`=右 | 二选一(1) |
| `ds-exp-<t|b|l|r>-t` |                 显示三角形“气泡”效果                 | 二选一(1) |

对`.ds-exp`的样式表进行编辑即可自定义其样式，不过请注意`/*<某属性>不可更改*/`的注释，更改这些属性可能导致难以预料的问题出现。

### 智能显示

如果Javascript发现拓展框被浏览器的边界截断，就会将拓展框移至其他地方以使其完全显示。与`.ds-tt`不同的是，它会先尝试平移至可以完全展现的区域，如果没有合适的区域，再转移至对面。

### 自定义显示

有时候不希望将拓展框居中对齐将其展开的元素？可以直接编写嵌入样式或内联样式来操控具体位置。拓展框的`position`为`relative`。

```css
element{
    top: 2rem;
    left: 0;
}
```

### 极端情况

不兼容在同一个元素中包含多个带有`.ds-exp`的元素的状况，此时只有在文档流中最靠前的元素可以被识别。

---

和`.ds-tt`简直完全一样

## 六、固定栏（TODO）

`ds-win`并不需要总是滑动。有时候我们需要把一个窗口固定在某个位置，或更重要的，我们想把一个窗口重新放入正常文档流中。这时需要`ds-fixpos`来帮忙了。

### 新建

`document.createElement("div").classList.add("ds-fixpos")`。

要将其绑定到指定的窗口，编辑元素的Attribute：`data-ds-fixpos="<id1> <id2> ..."`。

示例：

```html
<div class="ds-win" id="id-1"></div>
<div class="ds-win" id="id-2"></div>
<div class="ds-win" id="id-3"></div>
<div class="ds-win" id="id-4"></div>
<div class="ds-win" id="id-5"></div>
...
<div class="ds-fixpos" data-ds-fixpos="id-1 id-2 id-3“></div>
```

对`ds-fixpos`的样式表进行编辑即可自定义其样式，不过请注意`/*<某属性>不可更改*/`的注释，更改这些属性可能导致难以预料的问题出现。

### 行为

当鼠标指针进入`ds-fixpos`区域时，它会显示并引导松开鼠标，若在`ds-fixpos`区域内松开鼠标，则窗口将固定至`ds-fixpos`区域内，成为`ds-fixpos`的子元素。当固定在`ds-fixpos`中的窗口被重新拖出来，它会**默认被放置到`body`的文档流起始点**，相当于`document.body.prepend`。

### 属性表

|  属性class  |      描述      | 互斥 | 缺省 |
| :---------: | :------------: | :--: | :--: |
| `ds-fixpos` | 定义一个固定栏 |      | 必需 |

### 极端情况

## 七、通知栏（TODO）
